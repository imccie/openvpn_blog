##openvpn安装及使用

[TOC]


###概述


&#160; &#160; &#160; &#160;用 **Openvpn** 很久了，一直没有研究更深入的用法。对软件的使用方法还停留在生成证书，使用证书的阶段。之前一直是个人使用，所以对其高级用法没有过多的关注。最近在组建实验室的时候，因为涉及到需要多人远程登录，并且要对每个人进行单独的访问限制，所以原有的Openvpn通用的配置方法已不再适用。通过研究，不但实现了多用户、多访问权限，还实现了针对 **Openvpn** 网络安全及攻击的防范，基本满足了众人对实验室远程访问的需求。
&#160; &#160; &#160; &#160;openvpn能实现什么功能，我想我没有必要再详细解释了，能找到这篇文章的人，必然在网上冲浪的过程中看到过很多描述Vpn的文章。哥们应该知道VPN技术有好几种，从2层VPN到3层VPN，诸如l2tp、pptp、ipsec、sslvpn等等。Openvpn属于那种呢，准确来说，它是基于TLS协议，工作在3层的一种VPN，一般都会认为它是sslvpn的一种。

###功能列表

Openvpn在实验室的实现的功能
###基本功能

**利用openvpn实现vpn基本功能包含证书登陆功能；**
1. 实现使用tcp来建立连接.应用原生支持udp,考虑到UDP在大网传输时存在优先级低、丢弃率高等问题，没有采用；
2. 采用Tap而未采用tun，原因在于tap为三层设备，而tun为二层设备，在转发控制时，tun设备需要类似点对点配置ip，步骤比tap设备要复杂，所以未采用。
3. 结合mysql(mariadb)与PAM模块实现使用数据库中的用户名密码登录;
4. 关闭多重CN功能，规定单一用户同一时间只能存在一个实例，不允许同一时间内多实例登录。
5. 记录用户单次上线下线时间，发送、接收字节数

###	增强网络类功能
- 通过配置数据库实现组配置功能。
- 能按照数据库中组配置的策略对用户进行网络配置，继而限制用户访问的网段。
- 可按照数据库中策略配置动态下发用户路由。

###网络攻击防护及用户安全防护
- 使用fail2ban实现openvpn的攻击防护,若用户在登录时输错密码过多,自动封停该用户ip60分钟
- 10分钟查询一次多次登录用户（Flapping user），为防止浪费系统资源，防止用户密码泄漏导致反复登陆，规定在10分钟内若反复登录6次及以上，主动封停用户账户。

###用户限制
- 流量超量封停功能，默认每人在单位时间（可按年月日或全部）内10G流量，超量会在本次退出登陆时封停
- 用户账户过期封停功能，默认每人一个月使用时间，超时会在本次退出登录时封停。

###其它

- 用户密码加密存储功能

###计划功能但未实现
- 有单独的网站供admin管理用户，可创建、删除、封停、解封、修改用户密码、查看用户登录信息，修改用户过期时间、修改用户流量限制等功能
- 用户在网站中可以修改密码、查看自己登陆的日志、看自己账户的状态
- 用户可以在线申请账户创建、解封、注销、改密码等业务。
